var canvas = document.getElementById("myCanvas");
var cxt = canvas.getContext('2d');
var canWidth = cxt.canvas.clientWidth;
var init = {top: 32, spaceH: 70};
var row2 = {
    y:init.top+init.spaceH,
    data:[
        {
            type:'Step',
            text:'1.1-系统版本检查',
            name:'step_2_1',
            arrowArr:[
                {
                    arrow:'drawBottomToLeft',
                    to:'step_3_1'
                }
            ],
            x:'',
            y:'',
            requestData:{}
        },
        {
            type:'Step',
            text:'1.2-系统内存检查',
            name:'step_2_2',
            arrowArr:[
                {
                    arrow:'drawBottomToLeft',
                    to:'step_3_1'
                }
            ]
        },
        {
            type:'Step',
            text:'1.3-系统swap检查',
            name:'step_2_3',
            arrowArr:[
                {
                    arrow:'drawBottomToRight',
                    to:'step_3_1'
                }
            ]
        },
        {
            type:'Step',
            name:'step_2_4',
            text:'1.4-安装目录检查',
            arrowArr:[
                {
                    arrow:'drawBottomToRight',
                    to:'step_3_1'
                }
            ]
        }
    ]
};
row2.data = calChartX(canWidth,row2.data, row2.y);
var row5 = {
    data:[
    {
            type:'Step',
            text:'4.1-禁用防火墙',
            name:'step_5_1',
            arrowArr:[
                {
                    arrow:'drawBottomToLeft',
                    to:'step_6_1'
                }
            ],
            x:'',
            y:'',
            requestData:{}
        },
        {
            type:'Step',
            text:'4.2-禁用selinux',
            name:'step_5_2',
            arrowArr:[
                {
                    arrow:'drawBottomToRight',
                    to:'step_6_1'
                }
            ]
        },

]
}
row5.data = calChartX(canWidth,row5.data, row5.y);

var row7 = {
    data:[
    {
            type:'Step',
            text:'6.1-创建用户和组',
            name:'step_7_1',
            arrowArr:[
                {
                    arrow:'drawBottomToLeft',
                    to:'step_8_1'
                }
            ],
            x:'',
            y:'',
            requestData:{}
        },
        {
            type:'Step',
            text:'6.2-创建目录',
            name:'step_7_2',
            arrowArr:[
                {
                    arrow:'drawBottomToRight',
                    to:'step_8_1'
                }
            ]
        },

]
}
row7.data = calChartX(canWidth,row7.data, row7.y);

var row9 = {
    data:[
    {
            type:'Step',
            text:'7.1-bash_profile配置',
            name:'step_9_1',
            arrowArr:[
                {
                    arrow:'drawBottomToLeft',
                    to:'step_10_1'
                }
            ],
            x:'',
            y:'',
            requestData:{}
        },
        {
            type:'Step',
            text:'7.2-sysctl.conf配置',
            name:'step_9_2',
            arrowArr:[
                {
                    arrow:'drawBottomToLeft',
                    to:'step_10_1'
                }
            ]
        },
        {
            type:'Step',
            text:'7.3-limits.conf配置',
            name:'step_9_3',
            arrowArr:[
                {
                    arrow:'drawBottomToTop',
                    to:'step_10_1'
                }
            ]
        },
         {
            type:'Step',
            text:'7.4-profile配置',
            name:'step_9_4',
            arrowArr:[
                {
                    arrow:'drawBottomToRight',
                    to:'step_10_1'
                }
            ]
        },
        {
            type:'Step',
            text:'7.5-hosts配置',
            name:'step_9_5',
            arrowArr:[
                {
                    arrow:'drawBottomToRight',
                    to:'step_10_1'
                }
            ]
        },

]
}
row9.data = calChartX(canWidth,row9.data, row9.y);

var flowData = [
    {
        row:1,
        y:init.top,
        data:[
            {
                type:'Start',
                text:'流程开始',
                name:'step_1_1',
                arrowArr:[
                    {
                        arrow:'drawBottomToTop',
                        to:'step_2_1'
                    },
                    {
                        arrow:'drawBottomToTop',
                        to:'step_2_2'
                    },
                    {
                        arrow:'drawBottomToTop',
                        to:'step_2_3'
                    }, {
                        arrow:'drawBottomToTop',
                        to:'step_2_4'
                    }
                ],
                x:canWidth/2,
                y:''
            }
        ]
    },
    {
        row:2,
        y:init.top+init.spaceH,
        data:row2.data,
        method:{
            onmousemove:null,
            onmouseleave:null,
            onclick:hoverSingleChart
        }
    },
    {
        row:3,
        y:'',
        data:[{
            type:'Step',
            text:'2-安装软件上传',
            name:'step_3_1',
            x:canWidth/2,
            arrowArr:[
                {
                    arrow:'drawBottomToTop',
                    to:'step_4_1'
                }
            ]
        }],
        method:{
            onmousemove:null,
            onmouseleave:null,
            onclick:hoverSingleChart
        }
    },
    {
        row:4,
        y:'',
        data:[
            {
                type:'Step',
                text:'3-生成安装配置文件',
                name:'step_4_1',
                x:canWidth/2,
                arrowArr:[
                    {
                        arrow:'drawBottomToTop',
                        to:'step_5_1'
                    },
                    {
                        arrow:'drawBottomToTop',
                        to:'step_5_2'
                    }
                ],
            }
        ],
         method:{
            onmousemove:null,
            onmouseleave:null,
            onclick:db_config
        }
    },
    {
        row:5,
        data:row5.data,
        method:{
            onmousemove:null,
            onmouseleave:null,
            onclick:dbinstall
        }
    },
    {
        row:6,
        y:'',
        data:[
            {
                type:'Step',
                text:'5-rpm包安装',
                name:'step_6_1',
                x:canWidth/2,
                arrowArr:[
                    {
                        arrow:'drawBottomToTop',
                        to:'step_7_1'
                    },
                    {
                        arrow:'drawBottomToTop',
                        to:'step_7_2'
                    }
                ],
            }
        ],
        method:{
            onmousemove:null,
            onmouseleave:null,
            onclick:dbinstall
        }
    },
    {
        row:7,
        data:row7.data,
        method:{
            onmousemove:null,
            onmouseleave:null,
            onclick:dbinstall
        }
    },
    {
        row:8,
        y:'',
        data:[
            {
                type:'Step',
                text:'7-系统文件配置',
                name:'step_8_1',
                x:canWidth/2,
                arrowArr:[
                    {
                        arrow:'drawBottomToTop',
                        to:'step_9_1'
                    },
                    {
                        arrow:'drawBottomToTop',
                        to:'step_9_2'
                    },
                    {
                        arrow:'drawBottomToTop',
                        to:'step_9_3'
                    },
                    {
                        arrow:'drawBottomToTop',
                        to:'step_9_4'
                    },
                    {
                        arrow:'drawBottomToTop',
                        to:'step_9_5'
                    }
                ],
            }
        ]
    },
    {
        row:9,
        data:row9.data,
        method:{
            onmousemove:null,
            onmouseleave:null,
            onclick:dbinstall
        }
    },
    {
        row:10,
        y:'',
        data:[
            {
                type:'Step',
                text:'8-关闭透明大页',
                name:'step_10_1',
                x:canWidth/2,
                arrowArr:[
                    {
                        arrow:'drawBottomToTop',
                        to:'step_11_1'
                    },
                    {
                        arrow:'drawBottomToTop',
                        to:'step_11_1'
                    }
                ],
            }
        ],
        method:{
            onmousemove:null,
            onmouseleave:null,
            onclick:dbinstall
        }
    },
    {
        row:11,
        y:'',
        data:[
            {
                type:'Step',
                text:'9-数据库软件安装',
                name:'step_11_1',
                x:canWidth/2,
                arrowArr:[
                    {
                        arrow:'drawBottomToTop',
                        to:'step_12_1'
                    }
                ],
            }
        ],
        method:{
            onmousemove:null,
            onmouseleave:null,
            onclick:dbinstall
        }
    },
    {
        row:12,
        y:'',
        data:[
            {
                type:'Step',
                text:'10-数据库监听安装',
                name:'step_12_1',
                x:canWidth/2,
                arrowArr:[
                    {
                        arrow:'drawBottomToTop',
                        to:'step_13_1'
                    }
                ],
            }
        ],
        method:{
            onmousemove:null,
            onmouseleave:null,
            onclick:dbinstall
        }
    },
    {
        row:13,
        y:'',
        data:[
            {
                type:'Step',
                text:'11-数据库安装',
                name:'step_13_1',
                x:canWidth/2,
                arrowArr:[
                    {
                        arrow:'drawBottomToTop',
                        to:'step_14_1'
                    }
                ],
            }
        ],
        method:{
            onmousemove:null,
            onmouseleave:null,
            onclick:dbinstall
        }
    },
    {
        row:14,
        y:'',
        data:[
            {
                type:'Step',
                text:'12-补丁安装',
                name:'step_14_1',
                x:canWidth/2,
                arrowArr:[
                    {
                        arrow:'drawBottomToTop',
                        to:'step_15_1'
                    }
                ],
            }
        ],
        method:{
            onmousemove:null,
            onmouseleave:null,
            onclick:dbinstall
        }
    },
    {
        row:15,
        y:'',
        data:[
            {
                type:'Step',
                text:'流程结束',
                name:'step_15_1',
                x:canWidth/2,
                arrowArr:[
                    {
                        arrow:'drawBottomToTop',
                        to:''
                    }
                ],
            }
        ]
    }
];
drawFlowChart(cxt,canvas,flowData, init.top, init.spaceH);

function hoverSingleChart(singleData){
    console.log("---------鼠标事件-----------");
    console.log(singleData);
    var btn_target = $(this);
        if(btn_target.hasClass('disabled')){
            common_ops.alert('正在处理，请不要重复点击！');
            return;
        }
    btn_target.addClass('disabled');
    var getdata = null;
    getdata = function(user,pwd,ip){
    $.ajax({
           url:common_ops.buildUrl("/dbinstall/"),
           type:"POST",
           dataType:"json",
           data:{
                tag:singleData.text,
                ip:ip,
                pwd:pwd,
                user:user
           },
           success:function (res){
               btn_target.removeClass('disabled');
               var callback = null;
               if(res.code == 200){

               }
                common_ops.alert(res.msg,callback);
           }
        });
    };
    common_ops.prompt_1(singleData.text,getdata);
};

function db_config(singleData){
    console.log("---------鼠标事件-----------");
    console.log(singleData);
    var btn_target = $(this);
        if(btn_target.hasClass('disabled')){
            common_ops.alert('正在处理，请不要重复点击！');
            return;
        }
    btn_target.addClass('disabled');
    var getdata = null;
    getdata = function(db_install_info){
    $.ajax({
           url:common_ops.buildUrl("/dbinstall/"),
           type:"POST",
           dataType:"json",
           data:{
                tag:singleData.text,
                ora_ins_dir:db_install_info[0],
                ora_tool_dir:db_install_info[1],
                ora_data_dir:db_install_info[2],
                ora_arch_dir:db_install_info[3],
                oracle_base:db_install_info[4],
                oracle_home:db_install_info[5],
                ora_pwd:db_install_info[6],
                ora_sid:db_install_info[7],
                client_lang:db_install_info[8],
                sga_size:db_install_info[9],
                ip:db_install_info[10],
                host:db_install_info[11],
                soft_dir:db_install_info[12],
                root_pwd:db_install_info[13],
                db_soft:db_install_info[14],
                sys_pwd:db_install_info[15],
                system_pwd:db_install_info[16],
                db_mem:db_install_info[17],
                db_lang:db_install_info[18],
                opatch_file:db_install_info[19],
                opatch:db_install_info[20]
           },
           success:function (res){
               btn_target.removeClass('disabled');
               var callback = null;
               if(res.code == 200){

               }
                common_ops.alert(res.msg,callback);
           }
        });
    };
    common_ops.prompt_2(singleData.text,getdata);
};

function dbinstall(singleData){
    console.log("---------鼠标事件-----------");
    console.log(singleData);
    var btn_target = $(this);
        if(btn_target.hasClass('disabled')){
            common_ops.alert('正在处理，请不要重复点击！');
            return;
        }
    btn_target.addClass('disabled');
    var getdata = null;
    getdata = function(){
    $.ajax({
           url:common_ops.buildUrl("/dbinstall/"),
           type:"POST",
           dataType:"json",
           data:{
                tag:singleData.text
           },
           success:function (res){
               btn_target.removeClass('disabled');
               var callback = null;
               if(res.code == 200){

               }
                common_ops.alert(res.msg,callback);
           }
        });
    };
    common_ops.alert('是否要进行' + '“' + singleData.text + '”' + '操作？',getdata);
};